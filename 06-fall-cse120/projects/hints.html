<html xmlns:str="http://exslt.org/strings" lang="en">
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>CSE 120 Fall 2005: Projects</title> 

<base href="">

<meta content="text/html; charset=UTF-8" http-equiv="content-type">
<meta content="en" http-equiv="content-language">
<meta content="text/css" http-equiv="content-style-type">
<meta content="no" http-equiv="imagetoolbar">
<meta content="Computer Science, engineering, ucsd, faculty, students, Jacobs School, San Diego, University" name="keywords">
<meta content="UCSD Department of Computer Science and Engineering" name="description">
<meta content="UCSD Department of Computer Science and Engineering" name="organization">
<meta content="4.3.4.0" name="pageno">
<link media="screen" type="text/css" href="http://www.cs.ucsd.edu/css/global_style.css" rel="stylesheet">
<script type="text/javascript" language="JavaScript" src="http://www.cs.ucsd.edu/javascript/global_functions.js"> </script><script language="JavaScript" type="text/javascript">
<!--
        var NS4, IE, DOMstandard, CSScapable;
        NS4 = (document.layers) ? 1 : 0;
        IE = (document.all) ? 1 : 0;
        DOMstandard = (document.getElementById) ? 1 : 0;
        CSScapable = (NS4 || IE || DOMstandard) ? 1 : 0;
        if(CSScapable)
        {
          if(NS4)
            document.write('<link type="text/css" href="../../../css/ns_style.css" rel="stylesheet">');
            else
  	      document.write('<link media="screen" type="text/css" href="../../../css/dom_style.css" rel="stylesheet">');
            }
//-->
          </script>
</head>
<body link="#006699" vlink="#800000" alink="#FF0000" marginwidth="0" marginheight="0" topmargin="0" leftmargin="0" rightmargin="0" style="background: #ffffff url(../../../images/IMG_bgimg.gif) no-repeat">
<a name="top"> </a><script type="text/javascript" language="JavaScript">
<!--

      logotopon = new Image(187,29);
      logotopon.src = "../../../images/H_logo_top_over.gif";
      logotopoff = new Image(187,29);
      logotopoff.src = "../../../images/H_logo_top.gif";
      logobottomon = new Image(187,18);
      logobottomon.src = "../../../images/H_logo_bottom_over.gif";
      logobottomoff = new Image(187,18);
      logobottomoff.src = "../../../images/H_logo_bottom.gif";
      headeron = new Image(573,47);
      headeron.src = "../../../images/H_header_on.gif";
      headeroff = new Image(573,47);
      headeroff.src = "../../../images/H_header_off.gif";
        
//-->
</script>
<table bgcolor="#efefef" cellpadding="0" cellspacing="0" border="0" width="760">
<tr>
<td valign="top" width="187"><a onmouseout="Off('logotop')" onmouseover="On('logotop'); return true" href="http://www.ucsd.edu"><img border="0" width="187" height="29" src="http://www.cs.ucsd.edu/images/H_logo_top.gif" name="logotop" alt="UCSD Main Website"></a><a onmouseout="Off('logobottom')" onmouseover="On('logobottom'); return true" href="http://www.jacobsschool.ucsd.edu"><img border="0" width="187" height="18" src="http://www.cs.ucsd.edu/images/H_logo_bottom.gif" name="logobottom" alt="UCSD Jacobs School"></a></td><td valign="top" width="573"><a onmouseout="Off('header')" onmouseover="On('header'); return true" href="http://www.cs.ucsd.edu/index.php"><img border="0" width="573" height="47" src="http://www.cs.ucsd.edu/images/H_header_off.gif" name="header" alt="Department of Computer Science and Engineering"></a></td>
</tr>
</table>

<table cellpadding="0" cellspacing="0" border="0" width="760">
<tr>
<td bgcolor="#efefef" valign="top" width="760"><img border="0" width="1" height="12" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" border="0" width="760">
<tr>
<td bgcolor="#efefef" valign="top" width="12"><img border="0" width="12" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td valign="top" bgcolor="#efefef" width="172">
<table cellpadding="0" cellspacing="0" border="0" width="172">
<tr><td bgcolor="#ffffff" valign="top" colspan="4" width="172">
<a href="http://www.cs.ucsd.edu/classes/fa05/cse120/index.html"><img border="0" width="172" height="38" src="http://www.cs.ucsd.edu/classes/fa05/cse120/120.gif" alt="CSE 120"></a></td></tr
<tr>
<td bgcolor="#cccccc" valign="top" width="1"><img border="0" width="1" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td bgcolor="#ffffff" valign="top" width="6"><img border="0" width="6" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td bgcolor="#ffffff" valign="top" width="159">
<table border="0" cellpadding="0" cellspacing="0" width="159">
<tr>
<td colspan="3" width="159"><img border="0" width="1" height="10" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>
<tr>
<td valign="top" width="9"></td><td valign="top" width="5"><img border="0" width="5" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td valign="top" width="145"><font class="subnav" size="-2" face="verdana, arial, geneva, san-serif"><a href="http://www.cs.ucsd.edu/classes/fa05/cse120/general.html"><b>Course Overview</b></a></font></td>
</tr>
<tr>
<td valign="top" width="9"><img border="0" width="9" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td valign="top" width="5"><img border="0" width="5" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td valign="top" width="145"><font class="subnav" size="-2" face="verdana, arial, geneva, san-serif"><a href="http://www.cs.ucsd.edu/classes/fa05/cse120/general.html#structure"><b>Structure</b></a></font></td>
</tr>
<tr>
<td valign="top" width="9"><img border="0" width="9" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td valign="top" width="5"><img border="0" width="5" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td valign="top" width="145"><font class="subnav" size="-2" face="verdana, arial, geneva, san-serif"><a href="http://www.cs.ucsd.edu/classes/fa05/cse120/general.html#grading"><b>Grading</b></a></font></td>
</tr>
<tr>
<td valign="top" width="9"><img border="0" width="9" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td valign="top" width="5"><img border="0" width="5" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td valign="top" width="145"><font class="subnav" size="-2" face="verdana, arial, geneva, san-serif"><a href="http://www.cs.ucsd.edu/classes/fa05/cse120/general.html#collaboration"><b>Collaboration</b></a></font></td>
</tr>
<tr>
<td valign="top" width="9"><img border="0" width="9" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td valign="top" width="5"><img border="0" width="5" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td valign="top" width="145"><font class="subnav" size="-2" face="verdana, arial, geneva, san-serif"><a href="http://www.cs.ucsd.edu/classes/fa05/cse120/general.html#books"><b>Useful books</b></a></font></td>
</tr>
<tr>
<td colspan="3" width="159"><img border="0" width="159" height="5" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>
<tr>
<td valign="top" width="9"><img border="0" width="9" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td valign="top" width="5"><img border="0" width="5" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td valign="top" width="145"><font class="subnav" size="-2" face="verdana, arial, geneva, san-serif"><a href="http://www.cs.ucsd.edu/classes/fa05/cse120/schedule.html"><b>Schedule</b></a></font></td>
</tr>
<tr>
<td colspan="3" width="159"><img border="0" width="159" height="5" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>
<tr>
<td valign="top" width="9"><td valign="top" width="5"><img border="0" width="5" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td valign="top" width="145"><font class="subnav" size="-2" face="verdana, arial, geneva, san-serif"><a href="http://www.cs.ucsd.edu/classes/fa05/cse120/projects/"><b>Projects</b></a></font></td>
</tr>
<tr>
<td colspan="3" width="159"><img border="0" width="159" height="5" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>
<tr>
<td valign="top" width="9"><td valign="top" width="5"><img border="0" width="5" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</td>
<td valign="top" width="145"><font class="subnav" size="-2" face="verdana, arial, geneva, san-serif"><a href="http://www.cs.ucsd.edu/classes/fa05/cse120/homework/"><b>Homeworks</b></a></font></td>
</tr>
<tr>
<td colspan="3" width="159"><img border="0" width="159" height="5" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>
<tr>
<td valign="top" width="9"><td valign="top" width="5"><img border="0" width="5" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td valign="top" width="145"><font class="subnav" size="-2" face="verdana, arial, geneva, san-serif"><b><a href="http://webboard.ucsd.edu">WebBoard</a></b></font></td>
</tr>
<tr>
<td colspan="3" width="159"><img border="0" width="159" height="5" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>
</table>
</td><td bgcolor="#ffffff" valign="top" width="6"><img border="0" width="6" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" border="0" width="172">
<tr>
<td bgcolor="#efefef" valign="top" width="172"><img border="0" width="172" height="12" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" border="0" width="172">
<tr>
<td valign="top" colspan="6" width="172"><img border="0" width="172" height="26" src="http://www.cs.ucsd.edu/images/DA_IMG_search.gif" alt="Search"></td>
</tr>
<tr>
<td bgcolor="#cccccc" valign="top" width="1"><img border="0" width="1" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td bgcolor="#ffffff" valign="top" width="1"><img border="0" width="1" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td bgcolor="#eff5ef" valign="top" width="5"><img border="0" width="5" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td bgcolor="#eff5ef" valign="top" width="159">
<br>
<form onsubmit="return check_search_form(this)" id="site_search" name="site_search" method="post" action="http://www.cs.ucsd.edu/cgi-bin/htsearch">
<input value="htdig" name="config" type="hidden"><input value="" name="restrict" type="hidden"><input value="" name="exclude" type="hidden"><input maxlength="50" size="15" class="searchform" id="search" name="words" alt="search" type="text">&nbsp;&nbsp;<input type="image" name="searchnow" width="34" height="17" border="0" alt="search" align="top" src="http://www.cs.ucsd.edu/images/IMG_gobutton.gif">
</form>
<font class="body2" size="-2" face="verdana, arial, geneva, san-serif"><a href="http://www.cs.ucsd.edu/home/search.html"><b>Advanced search</b></a>&nbsp;&nbsp;</font><img border="0" width="8" height="5" src="http://www.cs.ucsd.edu/images/IMG_arrows.gif" alt="arrows gif" class="inlineimage"><br>
<br>
<img border="0" width="159" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td bgcolor="#eff5ef" valign="top" width="5"><img border="0" width="5" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td valign="top" bgcolor="#ffffff" width="1"><img border="0" width="1" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>
<tr>
<td valign="top" colspan="6" bgcolor="#ffffff" width="172"><img border="0" width="172" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" border="0" width="172">
<tr>
<td bgcolor="#efefef" valign="top" width="172"><img border="0" width="172" height="12" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>
</table>
</td><td bgcolor="#efefef" valign="top" width="12"><img border="0" width="12" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td bgcolor="#efefef" valign="top" width="552">
<table cellpadding="0" cellspacing="0" border="0" width="552">
<tr>
<td bgcolor="#cc9966" valign="top" colspan="3" width="552"><img border="0" width="552" height="15" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>

<tr>
<td bgcolor="#ffffff" valign="top" width="20"><img border="0" width="20" height="5" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td bgcolor="#ffffff" valign="top" width="512"><font class="body1" size="-1" face="verdana,arial, geneva, sans-serif"></font><img border="0" width="360" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td><td bgcolor="#ffffff" valign="top" width="20"><img border="0" width="20" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>

<tr>
<td bgcolor="#ffffff" valign="top" width="20"><img border="0" width="20" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
<td bgcolor="#ffffff" valign="top" width="512">
<font class="body1" size="-1" face="verdana,arial, geneva, sans-serif">

<h3>Strategy for tackling Nachos projects</h3>

<p>Here are some suggestions for getting started on the project.
This reflects my style of programming, but I would recommend
implementing project features one at a time and testing each feature
first before moving on to the next.  One example of this is part 1 of
project 1 -- first, ignore condition variables for a moment and
concentrate on implementing the Lock class just by itself.  Don't let
how CVs work confuse you about Locks.  I would implement Acquire and
Release, and then write a couple of test programs to test basics of
the Lock: have one thread acquire the lock, force a context switch
with Yield, have another thread try to acquire the lock to make
sure it sleeps, etc.</p>

<p>One you finish the Lock and finish testing the Lock, then move on
to CVs, etc.  And with Join, I would first implement the case where
Join is called on a thread that still exists (the easier case), and
then write a test program to make sure that it works as I would
expect.  And then I would implement the part of Join where Join is
called on a thread that has already finished.  And so on.  It may seem
like it would take longer to make progress, but in the long run it is
faster because you don't have to debug lots of code at one time.</p>

<h4>Locks</h4>

<p>We need to implement its two operations, Acquire and Release.  We
know that (1) we need to make them atomic, and (2) they are going to
block threads.  So what we will do is look at the implementation of
the Semaphore class to see how it does these things.</p>

<h4>Implementing the methods</h4>

<p>Let's start with Acquire.  We need to make Acquire atomic.  If we
look at the implementation of synch.cc:Semaphore::P(), we see that it
disables interrupts for atomicity.  So we will do the same for
Lock::Acquire.  P() has to worry about keeping track of a counter
before it blocks, but for the Lock we don't.  All we need to do is
check whether some other thread holds the Lock and block if so.</p>

<p>So pseudo code for Lock::Acquire is going to look something like:</p>

<pre>Lock::Acquire()
{
  disable interrupts;

    while (the lock is held)
    {
      put this thread (the current thread) on the wait Q for the lock;
      block this thread (make the current thread go to sleep);
    }

    do some bookkeeping;

    enable interrupts;
}</pre>

<p>Each of these actions is implemented in Semaphore::P(), so you should be able to look at the code for Semaphore::P() and do essentially the same thing.

<p>We can do the same thing for Lock::Release:</p>

<pre>Lock::Release()
{
  disable interrupts;

  remove a blocked thread from the Q, if there is one;
  unblock the removed thread;

  do some bookkeeping;

  enable interrupts;
}</pre>

<p>Again, each of these operations is used in the implementation of
Semaphore::V(), so we can essentially just copy them into the
implementation of Lock::Release().</p>

<p>NOTE: I did not check for error conditions in this pseudo code.</p>

<h4>Compiling</h4>

<p>We are going to put the code for Lock::Acquire and Lock::Release in
synch.cc.  So we put our code there where the skeleton functions are
defined.  Now we need to recompile Nachos.  To do this, all we need to
do is rerun "gmake" in the threads directory.</p>

<h4>Testing</h4>

<p>Ok, now we have an implementations of the Lock class and we compiled
it, removing all compilation errors.</p>

<p>So how do we test it?  This is where threadtest.cc comes in. If we
look in threadtest.cc, we see the function ThreadTest().  We know that
ThreadTest() is called from main() in main.cc.  So what we will do is
implement a new function in threadtest.cc, call it LockTest(), and change
the ThreadTest function in threadtest.cc to invoke that function.  

<p>Here is a modified version of
<a href="http://www.cs.ucsd.edu/classes/fa05/cse120/projects/threadtest.cc">threadtest.cc</a>
that does this. Note that, in this test, two threads are created, the first
thread runs, acquires the lock, yields to the second thread, which runs, tries
to acquire the lock but blocks, gives up the CPU to the first thread, and the
first thread continues, etc.  This behavior is highlighted by the output below.
</p>

<p>You can use the command line argument "-q" to invoke different test
functions you have implemented in threadtest.cc.  To invoke LockTest, do the
following:</p>

<pre>% ./nachos -q 2
L1:0
L1:1
L2:0
L1:2
L1:3
L2:1
L2:2
L2:3
No threads ready or runnable, and no pending interrupts.
Assuming the program completed.
Machine halting!

Ticks: total 110, idle 0, system 110, user 0
Disk I/O: reads 0, writes 0
Console I/O: reads 0, writes 0
Paging: faults 0
Network I/O: packets received 0, sent 0

Cleaning up...</pre>

<p>We used printf's to see how the threads were executing.  We can
also use Nachos' debug facility to trace context switches and threads
moving around on queues.  Try running the following:</p>

<pre>% ./nachos -d t -q 2</pre>

<p>Ok, we've written an implementation of the Lock class and written
a test program for it.  Once you're confident that your Lock class
works, you can move on to implementing the Condition class.  Go about
implementing Condition in the same way.  Write down its pseudo code,
look at the implementation of Semaphore and Lock to see how each step
should be implemented in Nachos, compile, and then write test cases
that validates its implementation.  Implement and test one behavior at
a time so that you do not try to juggle too much.</p>

<br>

</font>
</td><td bgcolor="#ffffff" valign="top" width="20"><img border="0" width="20" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>
<tr>
<br>
<p>
</font><img border="0" width="532" height="12" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" border="0" width="552">
<tr>
<td bgcolor="#efefef" valign="top" width="552"><img border="0" width="552" height="12" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>
</table>
</td><td bgcolor="#efefef" valign="top" width="12"><img border="0" width="12" height="1" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" border="0" width="760">
<tr>
<td bgcolor="#efefef" valign="top" width="760"><img border="0" width="760" height="12" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" border="0" width="760">
<tr>
<td bgcolor="#003366" valign="top" align="center" width="760"><font class="addy" color="#ffffff" size="-2" face="verdana, arial, geneva, san-serif">9500 Gilman Drive, La Jolla, CA 92093-0114<br>
</font></td>
</tr>
<tr>
<td bgcolor="#efefef" valign="top" width="760"><img border="0" width="760" height="12" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>
<tr>
<td bgcolor="#efefef" align="center" width="760"><font class="footernav" color="#003366" size="-2" face="verdana, arial, geneva, san-serif"><b><a href="http://www.cs.ucsd.edu/aboutcse/deptoverview.html">About CSE</a></b> | 
          <b><a href="http://www.cs.ucsd.edu/csepeople/csepeoplehome.html">CSE People</a></b> | 
          <b><a href="http://www.cs.ucsd.edu/facresearch/facultyresearch.html">Faculty &amp; Research</a></b> | 
          <b><a href="http://www.cs.ucsd.edu/gradedu/gradeduhome.html">Graduate Education</a></b> | 
          <b><a href="http://www.cs.ucsd.edu/undergrad/undergradeduhome.html">Undergraduate Education</a></b>
<br>
<b><a href="http://www.cs.ucsd.edu/deptadmin/index.php">Department Administration</a></b> | 
          <b><a href="http://www.cs.ucsd.edu/aboutcse/contactinfo.html">Contact CSE</a></b> | 
          <b><a href="http://www.cs.ucsd.edu/home/help/index.html">Help</a></b> | 
          <b><a href="http://www.cs.ucsd.edu/home/search.html">Search</a></b> | 
          <b><a href="http://www.cs.ucsd.edu/progress/progressroot.html">Site map</a></b> |
          <b><a href="http://www.cs.ucsd.edu/index.php">Home</a></b>
<br>
<a href="mailto:snoeren@cs.ucsd.edu">snoeren@cs.ucsd.edu</a>
<br>
</font><a href="http://www.ucsd.edu/"><img border="0" width="379" height="25" src="http://www.cs.ucsd.edu/images/IMG_footer.gif" alt="Official web page of the University of California, San Diego" class="inlineimage"></a></td>
</tr>
<tr>
<td bgcolor="#efefef" align="center" width="760"><font class="copyright" color="#003366" size="-2" face="verdana, arial, geneva, san-serif">
          Copyright 
          &copy;
          2002 Regents of the University of California.  All rights reserved.
          
          
        </font></td>
</tr>
<tr>
<td bgcolor="#efefef" valign="top" width="760"><img border="0" width="760" height="15" src="http://www.cs.ucsd.edu/images/space.gif" alt="spacer gif"></td>
</tr>
</table>
</body>
</html>
